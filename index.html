<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>문구 이미지 생성기</title>

<style>
    body {
        background: #000;
        color: #fff;
        text-align: center;
        padding: 20px;
        font-family: 'NanumSquare', sans-serif;
    }
    input {
        width: 80%;
        max-width: 400px;
        padding: 10px;
        font-size: 18px;
        margin-top: 20px;
        border-radius: 6px;
    }
    button {
        padding: 10px 20px;
        margin-top: 15px;
        font-size: 18px;
        cursor: pointer;
    }
    canvas {
        margin-top: 25px;
        width: 90%;
        max-width: 600px;
        border: 1px solid #333;
    }
</style>

<link href="https://cdn.jsdelivr.net/gh/moonspam/NanumSquare@1.0/nanumsquare.css" rel="stylesheet">

</head>
<body>

<h2 style="font-weight:300;">문구 이미지 생성</h2>

<input id="textInput" type="text" placeholder="텍스트를 입력하세요">
<button onclick="makeImage()">이미지 생성</button>

<br>
<canvas id="canvas" width="1080" height="720"></canvas>

<script>
function wrapTextByWord(ctx, text, maxCharsPerLine) {
    const words = text.split(" ");
    let line = "";
    let lines = [];

    for (let i = 0; i < words.length; i++) {
        let testLine = (line + words[i]).trim();

        if (testLine.length > maxCharsPerLine) {
            // 줄바꿈 발생
            if (line.length === 0) {
                // 단어 하나가 13자를 넘는 경우 (예외 처리)
                lines.push(words[i]);
            } else {
                lines.push(line.trim());
                line = words[i] + " ";
            }
        } else {
            line = testLine + " ";
        }
    }

    if (line.length > 0) lines.push(line.trim());

    return lines;
}

function makeImage() {
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    // 배경 검정
    ctx.fillStyle = "#000000";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    const inputText = document.getElementById("textInput").value;

    // 텍스트 스타일
    ctx.font = "300 67px 'NanumSquare'";
    ctx.fillStyle = "#ffe104";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";

    // 줄바꿈 처리 (단어 기준 / 13자 제한)
    const lines = wrapTextByWord(ctx, inputText, 13);

    // 여러 줄 중앙 정렬
    const lineHeight = 80;
    const totalHeight = lineHeight * (lines.length - 1);
    const startY = canvas.height / 2 - totalHeight / 2;

    lines.forEach((line, i) => {
        ctx.fillText(line, canvas.width / 2, startY + i * lineHeight);
    });

    // 로고 삽입
    const logo = new Image();
    logo.src = "t1logo.png";

    logo.onload = function () {
        const tempCanvas = document.createElement("canvas");
        tempCanvas.width = logo.width;
        tempCanvas.height = logo.height;
        const tctx = tempCanvas.getContext("2d");

        tctx.drawImage(logo, 0, 0);
        let imgData = tctx.getImageData(0, 0, logo.width, logo.height);
        let data = imgData.data;

        for (let i = 0; i < data.length; i += 4) {
            let gray = (data[i] + data[i + 1] + data[i + 2]) / 3;
            data[i] = gray;
            data[i + 1] = gray;
            data[i + 2] = gray;
        }

        tctx.putImageData(imgData, 0, 0);

        const logoWidth = 180;
        const logoHeight = (logo.height / logo.width) * logoWidth;

        // 로고 더 위쪽(10px) 유지
        ctx.drawImage(tempCanvas, canvas.width - logoWidth - 40, 10, logoWidth, logoHeight);
    };
}
</script>

</body>
</html>
